---
title: 工厂模式 与 单例模式
date: 2017-11-04 19:14:47
tags: 设计模式
category: 设计模式
---

# 工厂模式


## 创建一个framework\Think\Factory.php

```php
namespace Think;

class Factory
{
    static function createDatabase()
    {
        return new Database();
    }
}
```

## 入口文件调用

```php
define('BASEDIR', __DIR__);
include BASEDIR . '/Think/Loder.php';
spl_autoload_register('\\Think\\Loder::autoload');

// $obj = new Think\Database();
$obj = Think\Factory::createDatabase();
```

## 优点

使用工厂模式取代了传统的 new 的好处是：如果实例化的类名发生了变化，只需要修改工厂方法即可。

# 单例模式

## 创建数组库类(Think/Database.php)

```php
<?php
namespace Think;

class Database
{
    protected static $_instance;

    private function __construct()
    {

    }

    public static function getInstance()
    {
        if(!(self::$_instance instanceof self))
            {
                self::$_instance = new self;
            }
            return self::$_instance;
    }
    
    public function where($where)
    {
        return $this;
    }

    public function order($order)
    {
        return $this;
    }

    public function limit($limit)
    {
        return $this;
    }
    
}
```

## 将工厂类中的实例化也采用单例模式

```php
static function createDatabase()
{
	return Database::getInstance();
}
```

## 入口文件调用

```
$obj = Think\Database::getInstance();
$obj1 = Think\Factory::createDatabase();
var_dump($obj === obj1);
```

在 index.php 文件中实例化单例模式的类，无论实例化多少次，都只生成1个对象。


